# 📘 如何使用 AI 进化小镇

恭喜！项目已经完整开发完成。以下是详细的使用说明。

---

## 📦 项目已包含内容

✅ **完整的前端代码** - React 18 + Vite + Tailwind CSS  
✅ **完整的后端代码** - Node.js + Express + Coze API  
✅ **数据库结构** - PostgreSQL Schema  
✅ **8份详细文档** - 开发、部署、API、配置  
✅ **一键启动脚本** - Windows/Mac/Linux  
✅ **开源协议** - MIT License  

---

## 🚀 三步启动项目

### Windows 用户

```cmd
1. 双击运行 install.bat  （安装依赖）
2. 双击运行 start.bat     （启动项目）
3. 浏览器自动打开页面
```

### Mac/Linux 用户

```bash
# 1. 赋予执行权限
chmod +x install.sh start.sh

# 2. 安装依赖
./install.sh

# 3. 启动项目
./start.sh
```

### 手动启动

```bash
# 安装所有依赖
npm run install:all

# 启动开发服务器（前后端同时启动）
npm run dev
```

---

## 🌐 访问地址

启动成功后：
- **前端**: http://localhost:5173
- **后端**: http://localhost:3000
- **健康检查**: http://localhost:3000/health

---

## 🎮 开始游戏

### 1. 移动角色
- 使用 `W A S D` 键
- 或使用 `↑ ← ↓ →` 方向键

### 2. 与NPC互动
1. 走到NPC旁边（相邻1格以内）
2. 点击NPC
3. 弹出任务对话框

### 3. 完成任务

#### 🧙‍♂️ 提示词大师（紫色）
**测试答案**:
```
你是一个诗人，你的任务是写一首诗，要求五言绝句。
```
✅ 关键词：包含"角色"、"任务"、"要求"

#### 🎨 光影画师（粉色）
**测试答案**:
```
主体是一只赛博朋克猫，风格是霓虹灯光效果。
```
✅ 关键词：包含"主体"、"风格"

#### 🎬 视频导演（蓝色）
**测试答案**:
```
推镜头特写城市夜景，主体是高楼大厦。
```
✅ 关键词：包含"推镜头"或运镜、"主体"

#### 🤖 Coze架构师（绿色）
**测试答案**:
```
人设、技能、知识库
```
✅ 关键词：包含这三个核心组件

### 4. 获得奖励
- ✅ 验证通过 → +100积分
- 🎁 1%概率掉落稀有物品
- 🏆 查看实时排行榜

### 5. AI助教
- 点击右下角绿色问号按钮
- 输入问题，获得AI回答

---

## ⚙️ 配置 Coze API（可选但推荐）

### 为什么要配置？
- ❌ **不配置**: 使用简单关键词验证（功能受限）
- ✅ **配置后**: 使用真实AI评判，反馈更智能

### 配置步骤

1. **注册 Coze 账号**
   - 访问 https://www.coze.com
   - 使用邮箱注册

2. **创建 Bot**
   - 详细步骤见: `docs/COZE_SETUP.md`
   - 需要创建5个Bot（对应5个功能）

3. **获取 API Key**
   - 在 Coze 控制台 → 个人中心 → API密钥
   - 点击"创建API Key"
   - 复制密钥（格式：`pat_xxx`）

4. **填写配置**
   ```bash
   # 编辑 backend/.env
   COZE_API_KEY=pat_你的密钥
   COZE_BOT_PROMPT=bot_xxx1
   COZE_BOT_IMAGE=bot_xxx2
   COZE_BOT_VIDEO=bot_xxx3
   COZE_BOT_COZE=bot_xxx4
   COZE_BOT_ASSISTANT=bot_xxx5
   ```

5. **重启后端**
   ```bash
   # 按 Ctrl+C 停止
   # 重新运行 start.bat 或 npm run dev
   ```

---

## 💾 配置数据库（可选）

### 为什么要配置？
- ❌ **不配置**: 数据存储在浏览器localStorage（清除缓存会丢失）
- ✅ **配置后**: 数据云端同步，跨设备访问

### 配置步骤

1. **创建 Supabase 项目**
   - 访问 https://supabase.com
   - 免费注册并创建项目

2. **运行数据库脚本**
   - 在 Supabase 控制台 → SQL Editor
   - 复制 `backend/database/schema.sql` 内容
   - 粘贴并执行

3. **获取连接信息**
   - 在 Supabase → Settings → API
   - 复制以下信息：
     - Project URL
     - anon public key
     - service_role key

4. **填写配置**
   ```bash
   # 编辑 backend/.env
   SUPABASE_URL=https://xxx.supabase.co
   SUPABASE_ANON_KEY=你的anon_key
   SUPABASE_SERVICE_KEY=你的service_key
   ```

5. **重启后端**

详细步骤见: `backend/database/README.md`

---

## 📚 文档导航

根据你的需求，查看对应文档：

| 我想... | 查看文档 |
|---------|----------|
| 快速上手 | `START.md` 或 `docs/QUICK_START.md` |
| 了解完整开发流程 | `开发文档.md` |
| 配置 Coze API | `docs/COZE_SETUP.md` |
| 部署到服务器 | `docs/DEPLOYMENT.md` |
| 查看 API 接口 | `docs/API_REFERENCE.md` |
| 配置数据库 | `backend/database/README.md` |
| 了解项目交付 | `PROJECT_SUMMARY.md` |

---

## 🔧 常见问题

### Q1: 依赖安装失败？
```bash
# 清除缓存重试
npm cache clean --force
npm run install:all
```

### Q2: 端口被占用？
```bash
# 方法1: 修改端口
# backend/.env → PORT=3001

# 方法2: 关闭占用进程
# Windows: netstat -ano | findstr :3000
# Mac/Linux: lsof -ti:3000 | xargs kill
```

### Q3: 前端无法连接后端？
1. 检查后端是否启动：访问 http://localhost:3000/health
2. 查看浏览器控制台错误
3. 确认 `backend/.env` 的 `CORS_ORIGIN=http://localhost:5173`

### Q4: NPC没有反应？
1. 确保走到NPC旁边（相邻1格）
2. 点击NPC本体（Emoji图标）
3. 查看浏览器控制台是否有错误

### Q5: 验证总是失败？
- 如果没配置Coze，确保输入包含关键词
- 示例答案见上方"完成任务"部分

### Q6: 数据丢失了？
- 未配置Supabase时，数据存在localStorage
- 清除浏览器缓存会丢失数据
- 建议配置Supabase实现云端同步

---

## 🎨 自定义修改

### 修改地图

编辑 `frontend/src/config/gameConfig.js`:
```javascript
export const INITIAL_MAP = [
  [9, 9, 9, ...],  // 9=墙, 1=路, 0=草地
  // ... 修改地图布局
]
```

### 添加新NPC

1. 在 `gameConfig.js` 添加NPC定义
2. 在 Coze 创建对应Bot
3. 在 `backend/.env` 添加Bot ID

### 修改样式

编辑以下文件：
- `frontend/src/index.css` - 全局样式
- `frontend/tailwind.config.js` - Tailwind配置
- 各组件的 `className` - 组件样式

---

## 🚀 部署到线上

### 最简单方案：Vercel + Railway

#### 1. 部署前端到 Vercel
```bash
cd frontend
npm install -g vercel
vercel
# 按提示操作
```

#### 2. 部署后端到 Railway
1. 访问 https://railway.app
2. 连接GitHub仓库
3. 设置环境变量
4. 自动部署

详细步骤见: `docs/DEPLOYMENT.md`

---

## 📊 项目结构说明

```
ai-training-town/
├── frontend/              # 前端代码
│   ├── src/
│   │   ├── components/    # React组件（12个）
│   │   ├── store/         # 状态管理
│   │   ├── config/        # 游戏配置
│   │   └── services/      # API调用
│   └── package.json
│
├── backend/               # 后端代码
│   ├── src/
│   │   ├── routes/        # API路由（3个）
│   │   └── services/      # Coze、Supabase服务
│   └── database/          # 数据库结构
│
├── docs/                  # 文档目录（4份）
├── 开发文档.md             # 主文档
├── START.md               # 快速启动
└── package.json           # 工作区配置
```

---

## 💡 使用建议

### 学习路径

1. **第一天**: 
   - 启动项目，体验游戏
   - 阅读 `START.md`

2. **第二天**:
   - 配置 Coze API
   - 阅读 `docs/COZE_SETUP.md`

3. **第三天**:
   - 修改地图、添加NPC
   - 阅读 `开发文档.md`

4. **第四天**:
   - 部署到线上
   - 阅读 `docs/DEPLOYMENT.md`

### 教学使用

- **AI培训班**: 学员注册账号，完成任务获得积分
- **企业内训**: 部署内网版本，追踪员工学习进度
- **个人学习**: 本地运行，练习Prompt编写

---

## 🎯 下一步行动

### 立即体验
```bash
./start.bat       # Windows
./start.sh        # Mac/Linux
npm run dev       # 通用
```

### 深入开发
1. 阅读 `开发文档.md`
2. 修改配置文件
3. 添加自定义功能

### 部署上线
1. 配置 Coze API
2. 配置 Supabase
3. 参考 `docs/DEPLOYMENT.md` 部署

---

## 🆘 获取帮助

- 📖 **查看文档**: 8份详细文档覆盖所有场景
- 🐛 **提交问题**: GitHub Issues
- 💬 **常见问题**: 见本文档"常见问题"部分

---

## ✅ 检查清单

开始使用前，确认以下内容：

- [ ] Node.js 18+ 已安装
- [ ] 依赖已安装 (`npm run install:all`)
- [ ] 后端启动成功（访问 http://localhost:3000/health 返回OK）
- [ ] 前端启动成功（访问 http://localhost:5173 看到游戏）
- [ ] 可以移动角色
- [ ] 可以与NPC对话

可选配置：
- [ ] Coze API已配置（智能验证）
- [ ] Supabase已配置（数据持久化）

---

## 🎊 开始你的AI学习之旅！

所有准备工作已完成，现在可以：

1. 🎮 **体验游戏** - 启动项目，完成任务
2. 🔧 **配置增强** - Coze + Supabase
3. 🚀 **部署上线** - 分享给朋友
4. 🎨 **二次开发** - 添加新功能

---

<div align="center">

**祝你使用愉快！** 🎉

Made with ❤️ for AI Education

</div>

