# AI è¿›åŒ–å°é•‡ v2.0 - å®Œæ•´å¼€å‘æ–‡æ¡£

<div align="center">

**ğŸ® æ²‰æµ¸å¼ RPG é£æ ¼ AI æŠ€èƒ½åŸ¹è®­å¹³å°**

ç‰ˆæœ¬ï¼šv2.0.0 | æœ€åæ›´æ–°ï¼š2025-11-27

</div>

---

## ğŸ“š æ–‡æ¡£ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [å‰ç«¯å¼€å‘æŒ‡å—](#å‰ç«¯å¼€å‘æŒ‡å—)
5. [åç«¯å¼€å‘æŒ‡å—](#åç«¯å¼€å‘æŒ‡å—)
6. [API æ¥å£æ–‡æ¡£](#api-æ¥å£æ–‡æ¡£)
7. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
8. [Coze é›†æˆ](#coze-é›†æˆ)
9. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é¡¹ç›®æ¦‚è¿°

### äº§å“å®šä½

AIè¿›åŒ–å°é•‡æ˜¯ä¸€ä¸ª**æ¸¸æˆåŒ–å­¦ä¹ å¹³å°**ï¼Œé€šè¿‡RPGæ¢ç´¢çš„æ–¹å¼è®©å­¦å‘˜æŒæ¡AIæŠ€èƒ½ã€‚å­¦å‘˜æ§åˆ¶è§’è‰²åœ¨2Dåƒç´ é£åœ°å›¾ä¸Šè‡ªç”±ç§»åŠ¨ï¼Œä¸ä¸åŒçš„"AIæŠ€èƒ½å¤§å¸ˆï¼ˆNPCï¼‰"å¯¹è¯ï¼Œå®ŒæˆPromptç¼–å†™ä»»åŠ¡ï¼Œè·å¾—ç§¯åˆ†å’Œå¥–åŠ±ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### âœ… å·²å®ç°
- ğŸ—ºï¸ è‡ªç”±æ¢ç´¢çš„2Dåœ°å›¾ç³»ç»Ÿ
- ğŸ¤– 4ä¸ªä¸åŒç±»å‹çš„NPCå¯¼å¸ˆ
- âœï¸ ä»»åŠ¡æäº¤ä¸AIéªŒè¯
- ğŸ† ç§¯åˆ†ç³»ç»Ÿå’Œå®æ—¶æ’è¡Œæ¦œ
- ğŸ’ èƒŒåŒ…å’Œéšæœºæ‰è½æœºåˆ¶
- ğŸ’¬ AIåŠ©æ•™å®æ—¶ç­”ç–‘
- ğŸ¨ èµ›åšæœ‹å…‹åƒç´ é£UI

#### ğŸš§ å¼€å‘ä¸­
- ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- ç¤¾äº¤åˆ†äº«åŠŸèƒ½
- æˆå°±ç³»ç»Ÿ
- æ›´å¤šNPCå’Œä»»åŠ¡

#### ğŸ“… è§„åˆ’ä¸­
- å¤šäººå®æ—¶åœ¨çº¿
- UGCä»»åŠ¡åˆ›å»º
- ç§»åŠ¨ç«¯é€‚é…

### è§†è§‰é£æ ¼

- **è‰²è°ƒ**: æ·±è“é»‘ (#0f172a) + éœ“è™¹é»„ (#facc15) + é»‘å®¢ç»¿ (#22c55e)
- **å­—ä½“**: Press Start 2Pï¼ˆåƒç´ å­—ä½“ï¼‰
- **ç‰¹æ•ˆ**: CRTæ‰«æçº¿ã€å‘¼å¸åŠ¨ç”»ã€ç»ç’ƒæ‹Ÿæ€
- **åœ°å›¾**: çº¯CSSç»˜åˆ¶çº¹ç†ï¼ˆæ— å¤–éƒ¨å›¾ç‰‡ä¾èµ–ï¼‰

---

## æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·æµè§ˆå™¨                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  React 18 + Vite + Tailwind CSS              â”‚  â”‚
â”‚  â”‚  - GameMap (åœ°å›¾æ¸²æŸ“)                         â”‚  â”‚
â”‚  â”‚  - Player (è§’è‰²æ§åˆ¶)                          â”‚  â”‚
â”‚  â”‚  - NPCDialog (ä»»åŠ¡äº¤äº’)                       â”‚  â”‚
â”‚  â”‚  - Zustand (çŠ¶æ€ç®¡ç†)                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP/HTTPS
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Node.js + Express åç«¯                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Routes                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/validate (ä»»åŠ¡éªŒè¯)                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/assistant (AIåŠ©æ•™)                   â”‚  â”‚
â”‚  â”‚  â””â”€ /api/user (ç”¨æˆ·æ•°æ®)                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Services                     â”‚                   â”‚
â”‚  â”‚  â”œâ”€ cozeService.js            â”‚                   â”‚
â”‚  â”‚  â””â”€ supabaseService.js        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚
        â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Coze API    â”‚   â”‚  Supabase    â”‚
â”‚  (AIéªŒè¯)    â”‚   â”‚  (æ•°æ®åº“)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆè¯¦æƒ…

#### å‰ç«¯
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| React | 18.2 | UIæ¡†æ¶ |
| Vite | 5.0 | æ„å»ºå·¥å…· |
| Tailwind CSS | 3.3 | æ ·å¼æ¡†æ¶ |
| Zustand | 4.4 | çŠ¶æ€ç®¡ç† |
| Axios | 1.6 | HTTPå®¢æˆ·ç«¯ |

#### åç«¯
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Node.js | 18+ | è¿è¡Œç¯å¢ƒ |
| Express | 4.18 | Webæ¡†æ¶ |
| Supabase | 2.39 | æ•°æ®åº“ |
| Axios | 1.6 | HTTPå®¢æˆ·ç«¯ |
| dotenv | 16.3 | ç¯å¢ƒå˜é‡ |

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Node.js**: >= 18.0.0
- **npm**: >= 9.0.0
- **ç³»ç»Ÿ**: Windows / macOS / Linux

### å®‰è£…æ­¥éª¤

```bash
# 1. å…‹éš†é¡¹ç›®ï¼ˆæˆ–è§£å‹ï¼‰
git clone <repository-url>
cd ai-training-town

# 2. å®‰è£…æ‰€æœ‰ä¾èµ–
npm run install:all

# 3. é…ç½®åç«¯ç¯å¢ƒå˜é‡
cd backend
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å†™ Coze API Key ç­‰é…ç½®

# 4. é…ç½®å‰ç«¯ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
cd ../frontend
echo "VITE_API_URL=http://localhost:3000" > .env

# 5. è¿”å›æ ¹ç›®å½•ï¼Œå¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd ..
npm run dev
```

### è®¿é—®åº”ç”¨

æµè§ˆå™¨æ‰“å¼€ï¼š`http://localhost:5173`

---

## å‰ç«¯å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ GameMap.jsx      # åœ°å›¾ä¸»ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Player.jsx       # ç©å®¶è§’è‰²
â”‚   â”‚   â”œâ”€â”€ NPC.jsx          # NPCç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ NPCDialog.jsx    # å¯¹è¯æ¡†
â”‚   â”‚   â”œâ”€â”€ PlayerPanel.jsx  # å·¦ä¾§ä¿¡æ¯æ 
â”‚   â”‚   â”œâ”€â”€ AIAssistant.jsx  # AIåŠ©æ•™
â”‚   â”‚   â””â”€â”€ ControlHint.jsx  # æ“ä½œæç¤º
â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â””â”€â”€ gameStore.js     # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ gameConfig.js    # æ¸¸æˆé…ç½®å¸¸é‡
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ api.js           # APIè°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ App.jsx              # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ main.jsx             # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ index.css            # å…¨å±€æ ·å¼
â”œâ”€â”€ index.html               # HTMLæ¨¡æ¿
â”œâ”€â”€ vite.config.js           # Viteé…ç½®
â””â”€â”€ tailwind.config.js       # Tailwindé…ç½®
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### 1. GameMap.jsx - åœ°å›¾ç»„ä»¶

**åŠŸèƒ½**:
- æ¸²æŸ“16x12çš„ç½‘æ ¼åœ°å›¾
- å¤„ç†é”®ç›˜è¾“å…¥ï¼ˆWASD/æ–¹å‘é”®ï¼‰
- ç¢°æ’æ£€æµ‹
- ç®¡ç†NPCå’Œç©å®¶ä½ç½®

**ä»£ç ç¤ºä¾‹**:

```javascript
// é”®ç›˜ç§»åŠ¨æ§åˆ¶
useEffect(() => {
  const handleKeyDown = (e) => {
    if (activeNPC || showHelper) return
    
    let dx = 0, dy = 0
    if (e.key === 'w' || e.key === 'ArrowUp') dy = -1
    // ... å…¶ä»–æ–¹å‘
    
    const newX = player.position.x + dx
    const newY = player.position.y + dy
    
    if (canMoveTo(newX, newY)) {
      updatePosition({ x: newX, y: newY })
    }
  }
  
  window.addEventListener('keydown', handleKeyDown)
  return () => window.removeEventListener('keydown', handleKeyDown)
}, [player, activeNPC])
```

#### 2. gameStore.js - çŠ¶æ€ç®¡ç†

**ç®¡ç†çš„çŠ¶æ€**:
- `player`: ç©å®¶æ•°æ®ï¼ˆä½ç½®ã€ç§¯åˆ†ã€èƒŒåŒ…ï¼‰
- `activeNPC`: å½“å‰å¯¹è¯çš„NPC
- `leaderboard`: æ’è¡Œæ¦œæ•°æ®
- `chatHistory`: åŠ©æ•™èŠå¤©è®°å½•

**å…³é”®æ–¹æ³•**:

```javascript
// å¢åŠ ç§¯åˆ†
addScore: (points) => {
  set((state) => ({
    player: { ...state.player, score: state.player.score + points }
  }))
  // åŒæ­¥åˆ°localStorage
  localStorage.setItem('ai-town-save', JSON.stringify(state.player))
}

// æ£€æŸ¥æ˜¯å¦å¯ä»¥ä¸NPCäº’åŠ¨
canInteractWithNPC: (npcId) => {
  const state = get()
  const npc = NPCS.find(n => n.id === npcId)
  const distance = Math.abs(npc.x - state.player.position.x) + 
                   Math.abs(npc.y - state.player.position.y)
  return distance <= 1.5
}
```

#### 3. NPCDialog.jsx - å¯¹è¯ç³»ç»Ÿ

**æµç¨‹**:
1. ç©å®¶ç‚¹å‡»NPC â†’ å¼¹å‡ºå¯¹è¯æ¡†
2. æ˜¾ç¤ºä»»åŠ¡æè¿°
3. ç©å®¶è¾“å…¥ä½œä¸š
4. è°ƒç”¨APIéªŒè¯
5. æ ¹æ®ç»“æœå¢åŠ ç§¯åˆ†/æ˜¾ç¤ºåé¦ˆ

**éªŒè¯é€»è¾‘**:

```javascript
const handleSubmit = async () => {
  setIsLoading(true)
  
  try {
    const result = await validateTask({
      npcType: activeNPC.type,
      content: chatInput,
      keywords: activeNPC.keywords
    })
    
    if (result.passed) {
      addScore(100)
      // 1%æ¦‚ç‡æ‰è½
      if (Math.random() < 0.01) {
        const prize = PRIZE_POOL[Math.floor(Math.random() * PRIZE_POOL.length)]
        addInventory(prize)
      }
      alert('âœ… é€šå…³æˆåŠŸï¼')
    } else {
      alert('âŒ éªŒè¯å¤±è´¥')
    }
  } catch (error) {
    console.error(error)
  } finally {
    setIsLoading(false)
  }
}
```

### æ ·å¼ç³»ç»Ÿ

#### Tailwind è‡ªå®šä¹‰é…ç½®

```javascript
// tailwind.config.js
export default {
  theme: {
    extend: {
      colors: {
        'cyber-dark': '#0f172a',
        'cyber-yellow': '#facc15',
        'cyber-green': '#22c55e',
      },
      fontFamily: {
        'pixel': ['"Press Start 2P"', 'cursive'],
      },
      animation: {
        'float': 'float 2s infinite ease-in-out',
      }
    }
  }
}
```

#### CSS åœ°å½¢çº¹ç†

```css
/* è‰åœ°çº¹ç† */
.tile-grass {
  background-color: #22c55e;
  background-image: 
    radial-gradient(#15803d 15%, transparent 16%),
    radial-gradient(#15803d 15%, transparent 16%);
  background-size: 16px 16px;
  background-position: 0 0, 8px 8px;
}
```

### å¼€å‘è°ƒè¯•

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆçƒ­æ›´æ–°ï¼‰
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬
npm run preview
```

---

## åç«¯å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/              # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ validate.js      # ä»»åŠ¡éªŒè¯
â”‚   â”‚   â”œâ”€â”€ assistant.js     # AIåŠ©æ•™
â”‚   â”‚   â””â”€â”€ user.js          # ç”¨æˆ·æ•°æ®
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ cozeService.js   # Coze API
â”‚   â”‚   â””â”€â”€ supabaseService.js  # æ•°æ®åº“
â”‚   â””â”€â”€ server.js            # å…¥å£æ–‡ä»¶
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ schema.sql           # æ•°æ®åº“ç»“æ„
â”‚   â””â”€â”€ README.md            # æ•°æ®åº“é…ç½®è¯´æ˜
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ package.json
```

### æ ¸å¿ƒæœåŠ¡

#### cozeService.js - Coze API é›†æˆ

**ä¸»è¦æ–¹æ³•**:

```javascript
/**
 * è°ƒç”¨CozeéªŒè¯ä»»åŠ¡
 * @param {string} npcType - NPCç±»å‹ (prompt/image/video/coze)
 * @param {string} content - ç”¨æˆ·æäº¤å†…å®¹
 * @returns {Promise<{passed: boolean, feedback: string}>}
 */
export async function validateWithCoze(npcType, content) {
  const botId = BOT_IDS[npcType]
  
  const response = await axios.post(
    `${COZE_API_BASE}/chat`,
    {
      bot_id: botId,
      user: 'user_' + Date.now(),
      query: content,
      stream: false
    },
    {
      headers: {
        'Authorization': `Bearer ${COZE_API_KEY}`,
        'Content-Type': 'application/json'
      }
    }
  )
  
  const botReply = response.data.messages[0].content
  const passed = botReply.includes('é€šè¿‡')
  
  return { passed, feedback: botReply }
}
```

**é™çº§ç­–ç•¥**: å¦‚æœCoze APIä¸å¯ç”¨ï¼Œè‡ªåŠ¨å›é€€åˆ°æœ¬åœ°å…³é”®è¯éªŒè¯ã€‚

#### supabaseService.js - æ•°æ®æŒä¹…åŒ–

**ä¸»è¦æ–¹æ³•**:

```javascript
// ä¿å­˜ç”¨æˆ·è¿›åº¦
export async function saveUserProgress(userId, data) {
  const { error } = await supabase.from('user_progress').upsert({
    user_id: userId,
    score: data.score,
    inventory: data.inventory,
    position: data.position,
    updated_at: new Date().toISOString()
  })
}

// è·å–ç”¨æˆ·è¿›åº¦
export async function getUserProgress(userId) {
  const { data } = await supabase
    .from('user_progress')
    .select('*')
    .eq('user_id', userId)
    .single()
  return data
}
```

### ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `backend/.env`:

```env
# æœåŠ¡å™¨
PORT=3000
NODE_ENV=development

# Coze API
COZE_API_KEY=pat_your_key_here
COZE_BOT_PROMPT=bot_xxx1
COZE_BOT_IMAGE=bot_xxx2
COZE_BOT_VIDEO=bot_xxx3
COZE_BOT_COZE=bot_xxx4
COZE_BOT_ASSISTANT=bot_xxx5

# Supabase
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_KEY=your_service_key

# JWT
JWT_SECRET=your_secret_key

# CORS
CORS_ORIGIN=http://localhost:5173
```

### API æµ‹è¯•

ä½¿ç”¨ curl æµ‹è¯•ï¼š

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# éªŒè¯ä»»åŠ¡
curl -X POST http://localhost:3000/api/validate \
  -H "Content-Type: application/json" \
  -d '{
    "npcType": "prompt",
    "content": "ä½ æ˜¯ä¸€ä¸ªè¯—äººï¼Œä½ çš„ä»»åŠ¡æ˜¯å†™è¯—ï¼Œè¦æ±‚äº”è¨€ç»å¥",
    "keywords": ["è§’è‰²", "ä»»åŠ¡", "è¦æ±‚"]
  }'

# AIåŠ©æ•™
curl -X POST http://localhost:3000/api/assistant \
  -H "Content-Type: application/json" \
  -d '{"question": "ä»€ä¹ˆæ˜¯ç»“æ„åŒ–æç¤ºè¯ï¼Ÿ"}'
```

---

## API æ¥å£æ–‡æ¡£

### 1. POST /api/validate

éªŒè¯ç”¨æˆ·æäº¤çš„ä»»åŠ¡

**è¯·æ±‚ä½“**:
```json
{
  "npcType": "prompt",
  "content": "ä½ æ˜¯ä¸€ä¸ªè¯—äººï¼Œä½ çš„ä»»åŠ¡æ˜¯å†™è¯—ï¼Œè¦æ±‚äº”è¨€ç»å¥",
  "keywords": ["è§’è‰²", "ä»»åŠ¡", "è¦æ±‚"]
}
```

**å“åº”**:
```json
{
  "passed": true,
  "feedback": "å®Œç¾çš„ç»“æ„åŒ–æç¤ºè¯ï¼é€»è¾‘æ¸…æ™°ï¼"
}
```

**é”™è¯¯ç **:
- `400`: ç¼ºå°‘å¿…è¦å‚æ•°
- `500`: æœåŠ¡å™¨é”™è¯¯

---

### 2. POST /api/assistant

AIåŠ©æ•™é—®ç­”

**è¯·æ±‚ä½“**:
```json
{
  "question": "ä»€ä¹ˆæ˜¯ç»“æ„åŒ–æç¤ºè¯ï¼Ÿ"
}
```

**å“åº”**:
```json
{
  "answer": "ç»“æ„åŒ–æç¤ºè¯æ˜¯æŒ‡åŒ…å«è§’è‰²ã€ä»»åŠ¡ã€è¦æ±‚ä¸‰è¦ç´ çš„æç¤ºè¯..."
}
```

---

### 3. GET /api/user/:userId

è·å–ç”¨æˆ·è¿›åº¦

**å“åº”**:
```json
{
  "user_id": "uuid",
  "score": 500,
  "inventory": ["âœ¨ NVIDIA RTX 4090"],
  "position": { "x": 7, "y": 6 }
}
```

---

### 4. POST /api/user/save

ä¿å­˜ç”¨æˆ·è¿›åº¦

**è¯·æ±‚ä½“**:
```json
{
  "userId": "uuid",
  "data": {
    "score": 500,
    "inventory": ["item1"],
    "position": { "x": 7, "y": 6 }
  }
}
```

**å“åº”**:
```json
{
  "success": true,
  "message": "ä¿å­˜æˆåŠŸ"
}
```

---

## æ•°æ®åº“è®¾è®¡

### è¡¨ç»“æ„

#### users - ç”¨æˆ·è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| username | VARCHAR(50) | ç”¨æˆ·å |
| email | VARCHAR(100) | é‚®ç®± |
| avatar_url | TEXT | å¤´åƒURL |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

#### user_progress - ç”¨æˆ·è¿›åº¦
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| user_id | UUID | å¤–é”® â†’ users.id |
| score | INTEGER | ç§¯åˆ† |
| inventory | JSONB | èƒŒåŒ…ç‰©å“ |
| position | JSONB | ç©å®¶åæ ‡ |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ |

#### task_completions - ä»»åŠ¡è®°å½•
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| user_id | UUID | å¤–é”® â†’ users.id |
| npc_id | INTEGER | NPC ID |
| task_type | VARCHAR(20) | ä»»åŠ¡ç±»å‹ |
| submitted_content | TEXT | æäº¤å†…å®¹ |
| ai_feedback | TEXT | AIåé¦ˆ |
| passed | BOOLEAN | æ˜¯å¦é€šè¿‡ |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

### åˆ›å»ºæ•°æ®åº“

è¯¦è§ `backend/database/README.md`

---

## Coze é›†æˆ

è¯¦è§ `docs/COZE_SETUP.md`

**å…³é”®æ­¥éª¤**:
1. æ³¨å†Œ Coze è´¦å·
2. åˆ›å»º5ä¸ªBotï¼ˆå¯¹åº”ä¸åŒNPCï¼‰
3. é…ç½®Botäººè®¾å’Œè¯„å®¡è§„åˆ™
4. è·å–API Keyå’ŒBot ID
5. å¡«å…¥ `.env` é…ç½®

---

## éƒ¨ç½²æŒ‡å—

è¯¦è§ `docs/DEPLOYMENT.md`

**æ¨èæ–¹æ¡ˆ**:
- å‰ç«¯ï¼šVercelï¼ˆå…è´¹ï¼‰
- åç«¯ï¼šRailwayï¼ˆå…è´¹ï¼‰
- æ•°æ®åº“ï¼šSupabaseï¼ˆå…è´¹ï¼‰

---

## å¸¸è§é—®é¢˜

### Q1: å‰ç«¯æ— æ³•è¿æ¥åç«¯ï¼Ÿ

**è§£å†³**:
1. æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨ï¼š`http://localhost:3000/health`
2. æ£€æŸ¥ `frontend/.env` çš„ `VITE_API_URL`
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°CORSé”™è¯¯

### Q2: Coze API è°ƒç”¨å¤±è´¥ï¼Ÿ

**è§£å†³**:
1. æ£€æŸ¥ `.env` ä¸­çš„ `COZE_API_KEY`
2. ç¡®è®¤Bot IDæ­£ç¡®
3. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`[Coze] APIè°ƒç”¨å¤±è´¥`
4. ä¼šè‡ªåŠ¨é™çº§åˆ°æœ¬åœ°éªŒè¯

### Q3: æ•°æ®ä¸æŒä¹…åŒ–ï¼Ÿ

**è§£å†³**:
1. å¦‚æœæœªé…ç½®Supabaseï¼Œæ•°æ®å­˜å‚¨åœ¨ localStorage
2. é…ç½®Supabaseåï¼Œæ•°æ®ä¼šåŒæ­¥åˆ°äº‘ç«¯
3. æ£€æŸ¥ `SUPABASE_URL` å’Œ `SUPABASE_ANON_KEY`

### Q4: å¦‚ä½•æ·»åŠ æ–°çš„NPCï¼Ÿ

**æ­¥éª¤**:
1. åœ¨ `frontend/src/config/gameConfig.js` çš„ `NPCS` æ•°ç»„ä¸­æ·»åŠ ï¼š
```javascript
{
  id: 5,
  name: "æ–°NPC",
  type: "new_type",
  x: 5, y: 5,
  avatar: "ğŸ“",
  keywords: ["å…³é”®è¯1", "å…³é”®è¯2"]
}
```
2. åœ¨ Coze åˆ›å»ºå¯¹åº”çš„Bot
3. åœ¨ `backend/.env` æ·»åŠ  `COZE_BOT_NEW_TYPE=bot_xxx`

### Q5: å¦‚ä½•ä¿®æ”¹åœ°å›¾ï¼Ÿ

ç¼–è¾‘ `frontend/src/config/gameConfig.js` çš„ `INITIAL_MAP`:
```javascript
export const INITIAL_MAP = [
  [9, 9, 9, ...],  // ç¬¬1è¡Œ
  [9, 0, 1, ...],  // ç¬¬2è¡Œ
  // 0=è‰åœ°, 1=è·¯, 9=å¢™
]
```

### Q6: å¦‚ä½•è‡ªå®šä¹‰æ ·å¼ï¼Ÿ

ç¼–è¾‘ `frontend/src/index.css` æˆ– `frontend/tailwind.config.js`ã€‚

---

## å¼€å‘è·¯çº¿å›¾

### v2.1 (è®¡åˆ’ä¸­)
- [ ] ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] å¤šäººå®æ—¶æ’è¡Œæ¦œ
- [ ] æ›´å¤šNPCå’Œä»»åŠ¡
- [ ] æˆå°±ç³»ç»Ÿ

### v2.2 (è§„åˆ’ä¸­)
- [ ] ç¤¾äº¤åˆ†äº«åŠŸèƒ½
- [ ] UGCä»»åŠ¡åˆ›å»º
- [ ] ç§»åŠ¨ç«¯é€‚é…
- [ ] å¤šè¯­è¨€æ”¯æŒ

---

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### æœ¬åœ°å¼€å‘æµç¨‹
1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/æ–°åŠŸèƒ½`
3. æäº¤ä»£ç ï¼š`git commit -m 'æ·»åŠ æ–°åŠŸèƒ½'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/æ–°åŠŸèƒ½`
5. æäº¤ Pull Request

### ä»£ç è§„èŒƒ
- ä½¿ç”¨ ESLint æ ¼å¼åŒ–
- ç»„ä»¶æ–‡ä»¶åä½¿ç”¨ PascalCase
- å‡½æ•°ä½¿ç”¨ camelCase
- æ·»åŠ å¿…è¦çš„ä¸­æ–‡æ³¨é‡Š

---

## è”ç³»æ–¹å¼

- **æ–‡æ¡£é—®é¢˜**: æŸ¥çœ‹å„å­æ–‡æ¡£
- **æŠ€æœ¯æ”¯æŒ**: [GitHub Issues](../../issues)
- **éƒ¨ç½²é—®é¢˜**: å‚è€ƒ `docs/DEPLOYMENT.md`
- **Cozeé—®é¢˜**: å‚è€ƒ `docs/COZE_SETUP.md`

---

## è®¸å¯è¯

MIT License

---

<div align="center">
Made with â¤ï¸ by AI Town Team
</div>

